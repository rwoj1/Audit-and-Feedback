<style>
@media print {
  #barChart {
    max-width: 100% !important;
    height: auto !important;
  }
  canvas {
    page-break-inside: avoid;
    break-inside: avoid;
    display: block;
    margin: 0 auto;
  }
  #printableArea {
    width: 100%;
    max-width: 800px;
    margin: auto;
  }
  body {
    margin: 0;
    font-family: Arial, sans-serif;
  }
}
</style>

<script>
// Prevent duplicate submission for same medicine
function hasSubmittedMedicine(medicine) {
  const log = JSON.parse(localStorage.getItem("auditLog")) || {};
  return log[medicine];
}

function saveEntry(medicine, data) {
  const log = JSON.parse(localStorage.getItem("auditLog")) || {};
  log[medicine] = data;
  localStorage.setItem("auditLog", JSON.stringify(log));
}

function disableFormInputs() {
  const formElements = document.querySelectorAll("input, select, button");
  formElements.forEach(el => {
    if (el.id !== "printButton" && el.id !== "downloadCSV") {
      el.disabled = true;
    }
  });
}

function printReport() {
  requestAnimationFrame(() => {
    const originalCanvas = document.getElementById("barChart");
    const chartImage = new Image();
    chartImage.src = originalCanvas.toDataURL("image/png");
    chartImage.style.maxWidth = "100%";
    chartImage.style.display = "block";
    chartImage.style.margin = "0 auto";

    const printableArea = document.getElementById("printableArea").cloneNode(true);
    const canvasClone = printableArea.querySelector("#barChart");
    if (canvasClone && canvasClone.parentNode) {
      canvasClone.parentNode.replaceChild(chartImage, canvasClone);
    }

    const printWindow = window.open('', '', 'width=800,height=600');
    printWindow.document.write('<html><head><title>Audit Report</title>');
    printWindow.document.write('<style>body { font-family: Arial, sans-serif; margin: 40px; } img { max-width: 100%; height: auto; display: block; margin: 0 auto; }</style>');
    printWindow.document.write('</head><body>');
    printWindow.document.body.appendChild(printableArea);
    printWindow.document.write('</body></html>');
    printWindow.document.close();
    printWindow.focus();
    setTimeout(() => {
      printWindow.print();
      printWindow.close();
    }, 500);
  });
}
</script>
