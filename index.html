<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<div class="container">
  <h1>Medicine Prescribing Audit</h1>

  <!-- Data Type Selection -->
  <div class="form-group">
    <label for="practiceLevel">Type of Data: Practice vs Individual</label>
    <select id="practiceLevel">
      <option value="">Select...</option>
      <option value="practice">Practice Level Data</option>
      <option value="individual">Individual Level Data</option>
    </select>
  </div>

  <!-- Medicine Selection -->
  <div class="form-group">
    <label for="medicine">Medicine to Audit</label>
    <select id="medicine">
      <option value="">Select...</option>
      <option>Medicine A</option>
      <option>Medicine B</option>
      <option>Medicine C</option>
      <option>Medicine D</option>
      <option>Medicine E</option>
      <option>Medicine F</option>
    </select>
  </div>

  <!-- FTE / Hours -->
  <div id="fteInput" style="display:none;">
    <label>Total FTE per week</label>
    <input id="fte" type="number" />
  </div>
  <div id="hoursInput" style="display:none;">
    <label>Hours worked per week</label>
    <input id="hours" type="number" />
  </div>

  <!-- Prescribed -->
  <div class="form-group">
    <label id="prescribedLabel">Number of prescribed orders</label>
    <input id="prescribed" type="number" />
  </div>

  <!-- Generate -->
  <button onclick="generateReport()">Generate Report</button>

  <!-- Report -->
  <div id="report" style="display:none;">
    <h2>Audit Results</h2>
    <div style="width:100%; max-width:600px; height:400px;">
    <canvas id="barChart" style="width:100%; height:100%;"></canvas>
  </div></canvas>
    <p id="resultText"></p>
    <p id="resultAnalysis"></p>
  </div>
</div>

<style>
@media print {
  #barChart {
    max-width: 100% !important;
    height: auto !important;
  }
}
</style>
<script>
// Toggle FTE/hours inputs
document.getElementById('practiceLevel').addEventListener('change', function() {
  const fteInput = document.getElementById('fteInput');
  const hoursInput = document.getElementById('hoursInput');
  if (this.value === 'practice') { fteInput.style.display = 'block'; hoursInput.style.display = 'none'; }
  else if (this.value === 'individual') { fteInput.style.display = 'none'; hoursInput.style.display = 'block'; }
});

function generateReport() {
  const level = document.getElementById('practiceLevel').value;
  const medicine = document.getElementById('medicine').value;
  const prescribed = parseFloat(document.getElementById('prescribed').value);
  const fte = parseFloat(document.getElementById('fte').value) || 0;
  const hours = parseFloat(document.getElementById('hours').value) || 0;
  const denom = level === 'practice' ? fte : hours/38;
  const rate = prescribed / denom;

  // Render chart
  const ctx = document.getElementById('barChart').getContext('2d');
  new Chart(ctx, {
    type: 'bar',
    data: {
    data: {
      labels: ['Rate'],
      datasets: [{ data: [rate], label: medicine }]
    }
    , options: { responsive: true, maintainAspectRatio: false }
  });

  document.getElementById('resultText').textContent = 'Average Prescribing per Week: ' + rate.toFixed(2);
  document.getElementById('resultAnalysis').textContent = '';
  document.getElementById('report').style.display = 'block';
}
</script>
